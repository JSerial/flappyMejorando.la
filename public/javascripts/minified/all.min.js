function iniciar(){var a=document.getElementById("lienzo"),b=document.getElementById("preparate"),c=document.getElementById("btn-newgame"),d=document.getElementById("btn_fullscreen");a.width=340,a.height=510;var e=a.getContext("2d");lienzo=new Element(e,"fondo.png",0,0),tierra=new Element(e,"ground.png",-202,420),arbustos=new Element(e,"bush.png",0,380),tubo1=new Element(e,"pipe.png",-70,-150),tubo2=new Element(e,"pipe.png",-70,-150),tubo3=new Element(e,"pipe.png",-70,-150),flappy=new Element(e,"fly2.png",80,200),gameover=new Element(e,"game_over.png",40,70),puntaje=new Text(e,pts,155,100,"#ffffff"),b.addEventListener("mousedown",volar,!1),b.addEventListener("mouseup",caida,!1),c.addEventListener("click",reiniciarJuego),d.addEventListener("click",toggleFullScreen),ajustarPantalla(0)}function animationX(a,b){intervalX=setInterval(function(){var a=getRandom(40,200),c=200;if(lienzo.draw(),arbustos.draw(),juegoInicio&&(tubo1.x=tubo1.x<=-70?tubosPos:tubo1.x-1,tubo2.x=tubo1.x-c,tubo3.x=tubo1.x+c,tubo1.draw(),tubo2.draw(),tubo3.draw(),tubo1.x<=-70&&(tubo1.y=-1*a),tubo1.x<=flappy.x+24&&tubo1.x>=flappy.x-75&&tubo1.y+380<=flappy.y&&perdiste(),tubo1.x<=flappy.x+24&&tubo1.x>=flappy.x-75&&tubo1.y+285>=flappy.y&&perdiste(),tubo2.x<=flappy.x+24&&tubo2.x>=flappy.x-75&&tubo2.y+380<=flappy.y&&perdiste(),tubo2.x<=flappy.x+24&&tubo2.x>=flappy.x-75&&tubo2.y+285>=flappy.y&&perdiste(),tubo3.x<=flappy.x+24&&tubo3.x>=flappy.x-75&&tubo3.y+380<=flappy.y&&perdiste(),tubo3.x<=flappy.x+24&&tubo3.x>=flappy.x-75&&tubo3.y+285>=flappy.y&&perdiste(),flappy.y>386?(flappy.y=386,perdiste()):flappy.y=flappy.y+b),flappy.draw(),tierra.x=tierra.x<=-202?0:tierra.x-1,tierra.draw(),puntaje.drawText(),tubo1.x==flappy.x||tubo2.x==flappy.x||tubo3.x==flappy.x){var d=document.getElementById("score"),e=document.getElementById("lbl_puntos");pts+=1,d.value=pts,e.innerHTML=pts,puntaje.texto=pts,puntaje.drawText()}},a)}function getRandom(a,b){return Math.floor(Math.random()*(b-a+1))+a}function caida(){clearInterval(intervalX),animationX(10,2)}function volar(){var a=document.getElementById("preparate");clearInterval(intervalX),a.className+=" fadeOut",tubosPos=juegoInicio?330:600,juegoInicio=!0,flappy.vivo&&animationX(10,-5)}function moverAlas(){intervalFlappy=setInterval(function(){mueveAlas?(flappy.imagenURL="fly1.png",flappy.createImg(),flappy.draw(),mueveAlas=!1):(flappy.imagenURL="fly2.png",flappy.createImg(),flappy.draw(),mueveAlas=!0)},180)}function perdiste(){var a=document.getElementById("perdiste"),b=document.getElementById("preparate");puntaje.texto="",puntaje.drawText(),gameover.draw(),a.style.display="block",clearInterval(intervalX),clearInterval(intervalFlappy),flappy.vivo=!1,b.style.pointerEvents="none"}function reiniciarJuego(){var a=document.getElementById("perdiste"),b=document.getElementById("preparate"),c=document.getElementById("lbl_puntos");c.innerHTML=0,b.style.pointerEvents="auto",pts=0,juegoInicio=!1,a.style.display="none",b.classList.remove("fadeOut"),b.style.display="block",flappy.y=200,tubosPos=600,clearInterval(intervalX),iniciar(),window.onload()}function toggleFullScreen(){document.fullScreenElement&&null!==document.fullScreenElement||!document.mozFullScreen&&!document.webkitIsFullScreen?document.documentElement.requestFullScreen?document.documentElement.requestFullScreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullScreen&&document.documentElement.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen(),ajustarPantalla(121)}function ajustarPantalla(a){var b=document.getElementById("wrapper"),c=window.innerHeight,d=parseInt(c)+parseInt(a);b.style.height=d+"px"}function init(){var a=document.getElementById("refresh");loadJSON(),a.addEventListener("click",function(){loadJSON()})}function loadJSON(){var a=new XMLHttpRequest,b=url.dev+"/list_score";validacion_ajax(),a.onreadystatechange=function(){if(1==a.readyState||2==a.readyState||3==a.readyState){var b=document.getElementById("lista");b.innerHTML="<tr><th>Nombre</th><th>Puntos</th></tr>",b.innerHTML+="<tr><td colspan='2'><img width='40px' src='../images/load.gif'/></td></tr>",b.innerHTML+="<tr><td colspan='2'>Cargando...</td></tr>"}else if(4==a.readyState){var b=document.getElementById("lista"),c=document.getElementById("lbl_mejor"),d=JSON.parse(a.responseText);b.innerHTML="<tr><th>Nombre</th><th>Puntos</th></tr>";for(var e in d){var f=d[e].nombre,g=d[e].puntos;b.innerHTML+="<tr><td>"+f+"</td><td>"+g+"</td></tr>"}c.innerHTML=" "+d[0].puntos}},a.open("GET",b,!0),a.send()}function validacion_ajax(){try{http_request=new XMLHttpRequest}catch(a){try{http_request=new ActiveXObject("Msxml2.XMLHTTP")}catch(a){try{http_request=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){return console.log("Tu Navegador No Soporta XMLHttpRequest"),!1}}}}var lienzo,intervalX,intervalFlappy,juegoInicio,tubosPos,pts,mueveAlas;juegoInicio=!1,mueveAlas=!0,tubosPos=600,pts=0;var Element=function(a,b,c,d){this.contexto=a,this.imagenURL=b,this.imagenOK=!1,this.vivo=!0,this.x=c,this.y=d,this.createImg()};Element.prototype.createImg=function(){this.imagen=new Image,this.imagen.src=this.imagenURL,this.imagen.onload=this.confirmItem()},Element.prototype.confirmItem=function(){this.imagenOK=!0},Element.prototype.draw=function(){this.contexto.drawImage(this.imagen,this.x,this.y)};var Text=function(a,b,c,d,e){this.contexto=a,this.contexto.font="bold 3em sans-serif",this.contexto.fillStyle=e,this.contexto.strokeStyle="black",this.contexto.lineWidth=3,this.texto=b,this.x=c,this.y=d};Text.prototype.drawText=function(){this.contexto.fillText(this.texto,this.x,this.y),this.contexto.strokeText(this.texto,this.x,this.y)},window.onload=function(){animationX(10,2),moverAlas()};var url={dev:"http://localhost:3000",pro:"http://flappy-mejorandola.herokuapp.com"};